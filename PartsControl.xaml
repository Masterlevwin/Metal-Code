<UserControl x:Class="Metal_Code.PartsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Metal_Code"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="400">
    <UserControl.Resources>
        <local:IsNotPlaceholderConverter x:Key="IsNotPlaceholderConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <!-- Общие параметры -->
        <Border VerticalAlignment="Top">
            <StackPanel>
                <StackPanel>
                                            
                    <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Image Source="Images/nesting.png" Width="16"/>
                        <Button Content="Показать раскладки" Click="ShowNesting" HorizontalAlignment="Center" Width="150" Margin="4,0,0,0"/>
                    </StackPanel>

                    <StackPanel x:Name="StandartStack" Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Image Source="/Images/works.png" Margin="5,0,0,0" Width="16"/>
                        <ComboBox x:Name="StandartPartsDrop" Width="150" Margin="4,0,5,0" SelectedIndex="0">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Height" Value="28"/>
                                    <!-- Обязательно: иначе IsMouseOver не сработает на пустом месте -->
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Padding" Value="2,4"/>
                                    <!-- опционально: отступы -->
                                </Style>
                            </ComboBox.ItemContainerStyle>
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <!-- Используем Grid вместо StackPanel для лучшего контроля -->
                                    <Grid x:Name="ItemContainer" Background="Transparent">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="{Binding}" VerticalAlignment="Center" Margin="3,0"/>

                                        <Button Content="+" Grid.Column="1" Width="20" Margin="0,0,5,0" Click="Add_StandartPart" Tag="{Binding}">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsMouseOver, ElementName=ItemContainer}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Image Source="/Images/works2.png" Margin="5,0,0,0" Width="16"/>
                        <ComboBox x:Name="WorksDrop" SelectedIndex="0" Margin="4,0,5,0" SelectionChanged="SelectedWork" Width="150">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Height" Value="28"/>
                                    <!-- Обязательно: иначе IsMouseOver не сработает на пустом месте -->
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Padding" Value="2"/>
                                    <Setter Property="Margin" Value="2,0,2,0"/>
                                    <!-- опционально: отступы -->
                                </Style>
                            </ComboBox.ItemContainerStyle>
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <!-- Используем Grid вместо StackPanel для лучшего контроля -->
                                    <Grid x:Name="ItemContainer" Background="Transparent">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="{Binding}"  VerticalAlignment="Center" Margin="3,0"/>

                                        <StackPanel Orientation="Horizontal" Grid.Column="1" Margin="5,0,0,0">
                                            <Button Content="+" Width="20" Click="SetVisibleControl" Tag="{Binding}">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding IsMouseOver, ElementName=ItemContainer}" Value="True"/>
                                                                    <Condition Binding="{Binding Converter={StaticResource IsNotPlaceholderConverter}}" Value="True"/>
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </MultiDataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>

                                            <Button Content=">" Width="20" Margin="3,0,0,0" Click="SortDetails" Tag="{Binding}">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding IsMouseOver, ElementName=ItemContainer}" Value="True"/>
                                                                    <Condition Binding="{Binding Converter={StaticResource IsNotPlaceholderConverter}}" Value="True"/>
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </MultiDataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>

                                    </Grid>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>

                <!-- Блоки работ -->
                <Grid x:Name="WorksGrid" Width="240" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                        <TextBlock Text="Г" FontWeight="Bold" ToolTip="Гибка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="20"/>
                        <TextBox x:Name="Bend" TextChanged="SetProperty" ToolTip="Введите количество однотипных гибов" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" MaxLines="1" Width="30"/>
                        <ComboBox x:Name="BendDrop" SelectedIndex="0" ToolTip="Выберите длину гиба" SelectionChanged="SetType" Margin="5,0,0,0" Width="85"/>
                        <Button Content="-" ToolTip="Сбросить группы однотипных гибов" Margin="5,0,0,0" Click="SetDefaultBends" Width="30"/>
                        <Button x:Name="BendBtn" Content="Г+" ToolTip="Добавить гибку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="Св" FontWeight="Bold" ToolTip="Сварка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBox x:Name="Weld" TextChanged="SetProperty" ToolTip="Введите длину свариваемой поверхности, мм" MaxLines="1" Margin="5,0,0,0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Width="50"/>
                        <ComboBox x:Name="WeldDrop" SelectionChanged="SetType" ToolTip="Выберите тип расчета" SelectedIndex="0" Margin="5,0,0,0" Width="85"/>
                        <Button x:Name="WeldBtn" Content="Св+" ToolTip="Добавить сварку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" MinWidth="30" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="О" FontWeight="Bold" ToolTip="Окраска для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBox x:Name="Paint" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" MaxLines="1" ToolTip="Введите цвет RAL" LostFocus="SetProperty" Margin="5,0,0,0" Width="50"/>
                        <ComboBox x:Name="PaintDrop" SelectionChanged="SetType" Margin="5,0,0,0" ToolTip="Выберите тип расчета" SelectedIndex="0" Width="85"/>
                        <Button x:Name="PaintBtn" Content="О+" ToolTip="Добавить окраску" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="Р" FontWeight="Bold" ToolTip="Резьба для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBlock Text="⌀" Margin="10,0,0,0" Width="10" />
                        <TextBox x:Name="Wide1" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите диаметр отверстия" LostFocus="SetPropertyThread" Width="40"/>
                        <TextBlock Text="N" Margin="10,0,0,0" Width="10"/>
                        <TextBox x:Name="Holes1" TextChanged="SetProperty" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите количество отверстий" Width="40"/>
                        <Button x:Name="ThreadBtn" Content="Р+" ToolTip="Добавить резьбу" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="З" FontWeight="Bold" ToolTip="Зенковка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBlock Text="⌀" Margin="10,0,0,0" Width="10" />
                        <TextBox x:Name="Wide2" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите диаметр отверстия" LostFocus="SetPropertyThread" Width="40"/>
                        <TextBlock Text="N" Margin="10,0,0,0" Width="10"/>
                        <TextBox x:Name="Holes2" TextChanged="SetProperty" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите количество отверстий" Width="40"/>
                        <Button x:Name="CountersinkBtn" Content="З+" ToolTip="Добавить зенковку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" MinWidth="30" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="С" FontWeight="Bold" ToolTip="Сверловка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBlock Text="⌀" Margin="10,0,0,0" Width="10" />
                        <TextBox x:Name="Wide3" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите диаметр отверстия" LostFocus="SetPropertyThread" Width="40"/>
                        <TextBlock Text="N" Margin="10,0,0,0" Width="10"/>
                        <TextBox x:Name="Holes3" TextChanged="SetProperty" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите количество отверстий" Width="40"/>
                        <Button x:Name="DrillingBtn" Content="С+" ToolTip="Добавить сверловку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" MinWidth="30" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="В" FontWeight="Bold" ToolTip="Вальцовка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <ComboBox x:Name="RollDrop" SelectedIndex="0" ToolTip="Выберите сторону вальцовки" SelectionChanged="SetType" Margin="60,0,0,0" Width="85"/>
                        <Button x:Name="RollingBtn" Content="В+" ToolTip="Добавить вальцовку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="Ц" FontWeight="Bold" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBox HorizontalContentAlignment="Center" VerticalContentAlignment="Center" MaxLines="1" ToolTip="Текущий вес деталей на оцинковку" IsReadOnly="True" Margin="5,0,0,0" Width="50"/>
                        <TextBlock Text="кг" Margin="5,0,0,0" Width="25" />
                        <Button x:Name="ZincBtn" Content="Ц+" ToolTip="Добавить оцинковку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="Ф" FontWeight="Bold" ToolTip="Фрезеровка для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBox x:Name="TotalTime" TextChanged="SetProperty" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" MaxLines="1" ToolTip="Общее время фрезеровки" Margin="5,0,0,0" Width="50"/>
                        <TextBlock Text="мин" Margin="5,0,0,0" Width="25" />
                        <Button x:Name="MillingBtn" Content="Ф+" ToolTip="Добавить фрезеровку" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="Зк" FontWeight="Bold" ToolTip="Заклепки для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBlock Text="⌀" Margin="10,0,0,0" Width="10" />
                        <TextBox x:Name="Wide4" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите диаметр отверстия" LostFocus="SetPropertyThread" Width="40"/>
                        <TextBlock Text="N" Margin="10,0,0,0" Width="10"/>
                        <TextBox x:Name="Holes4" TextChanged="SetProperty" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="5,0,0,0" MaxLines="1" ToolTip="Введите количество отверстий" Width="40"/>
                        <Button x:Name="RivetsBtn" Content="Зк+" ToolTip="Добавить заклепки" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top" Visibility="Collapsed">
                        <TextBlock Text="А" FontWeight="Bold" ToolTip="Аквабластинг для всех" Margin="5,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" Width="30"/>
                        <TextBox HorizontalContentAlignment="Center" VerticalContentAlignment="Center" MaxLines="1" ToolTip="Площадь поверхности деталей" IsReadOnly="True" Margin="5,0,0,0" Width="50"/>
                        <TextBlock Text="кв м" Margin="5,0,0,0" Width="25"/>
                        <Button x:Name="AquaBtn" Content="А+" ToolTip="Добавить аквабластинг" Click="AddControl" FontWeight="Bold" Margin="5,0,0,0" Width="45"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Список изображений -->
        <ScrollViewer x:Name="imagesScroll"
              Grid.Column="1"
              HorizontalScrollBarVisibility="Auto"
              Visibility="Collapsed">
            <ItemsControl x:Name="imagesList" Margin="5">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </ScrollViewer>

        <!-- Список деталей -->
        <ScrollViewer x:Name="partsScroll"
              Grid.Column="1"
              HorizontalScrollBarVisibility="Auto">
            <ItemsControl x:Name="partsList" Margin="5" Padding="3">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </ScrollViewer>

    </Grid>
</UserControl>